Index: browse.php
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?php\r\ninclude __DIR__ . \"/header.php\";\r\n\r\n$ReturnableResult = null;\r\n$Sort = \"SellPrice\";\r\n$SortName = \"price_low_high\";\r\n$AmountOfPages = 0;\r\n$queryBuildResult = \"\";\r\n$SearchString = \"\";\r\n\r\nif (isset($_GET['category_id'])) {\r\n    $CategoryID = $_GET['category_id'];\r\n    $_SESSION[\"category_id\"] = $_GET['category_id'];\r\n} else {\r\n    $CategoryID = \"\";\r\n    $_SESSION[\"category_id\"]=$CategoryID;\r\n}\r\nif (isset($_GET['products_on_page'])) {\r\n    $ProductsOnPage = $_GET['products_on_page'];\r\n    $_SESSION['products_on_page'] = $_GET['products_on_page'];\r\n} else if (isset($_SESSION['products_on_page'])) {\r\n    $ProductsOnPage = $_SESSION['products_on_page'];\r\n} else {\r\n    $ProductsOnPage = 25;\r\n    $_SESSION['products_on_page'] = 25;\r\n}\r\nif (isset($_GET['page_number'])) {\r\n    $PageNumber = $_GET['page_number'];\r\n    $_SESSION[\"page_number\"] = $_GET['page_number'];\r\n} else {\r\n    $PageNumber = 0;\r\n}\r\nif (isset($_GET['search_string'])) {\r\n    $SearchString = $_GET['search_string'];\r\n    $_SESSION[\"search_string\"] = $_GET['search_string'];\r\n}\r\nif (isset($_GET['sort'])) {\r\n    $SortOnPage = $_GET['sort'];\r\n    $_SESSION[\"sort\"] = $_GET['sort'];\r\n} else if (isset($_SESSION[\"sort\"])) {\r\n    $SortOnPage = $_SESSION[\"sort\"];\r\n} else {\r\n    $SortOnPage = \"price_low_high\";\r\n    $_SESSION[\"sort\"] = \"price_low_high\";\r\n}\r\nif (isset($_GET['ColorID'])) {\r\n    $_SESSION[\"ColorID\"] = $_GET['ColorID'];\r\n} else {\r\n    $_SESSION[\"ColorID\"] = \"0\";\r\n}\r\nif (isset($_GET['SizeID'])) {\r\n    $_SESSION[\"SizeID\"] = $_GET['SizeID'];\r\n} else {\r\n    $_SESSION[\"SizeID\"] = \"0\";\r\n}\r\n\r\nswitch ($SortOnPage) {\r\n    case \"price_high_low\":\r\n    {\r\n        $Sort = \"SellPrice DESC\";\r\n        break;\r\n    }\r\n    case \"name_low_high\":\r\n    {\r\n        $Sort = \"StockItemName\";\r\n        break;\r\n    }\r\n    case \"name_high_low\";\r\n        $Sort = \"StockItemName DESC\";\r\n        break;\r\n    case \"price_low_high\":\r\n    {\r\n        $Sort = \"SellPrice\";\r\n        break;\r\n    }\r\n    default:\r\n    {\r\n        $Sort = \"SellPrice\";\r\n        $SortName = \"price_low_high\";\r\n    }\r\n}\r\n\r\nif ($SearchString != \"\") {\r\n    $SearchString = str_replace(\"'\", \"\", $SearchString); //Voorkoming SQL-injectie: Haalt single aanhalingstekens weg\r\n    $searchValues = explode(\" \", $SearchString);\r\n    $queryBuildResult .= \"(\";\r\n    for ($i = 0; $i < count($searchValues); $i++) {\r\n        if ($i != 0) {\r\n            $queryBuildResult .= \"AND \";\r\n        }\r\n        $queryBuildResult .= \"SI.SearchDetails LIKE '%$searchValues[$i]%' \";\r\n    }\r\n    if(is_int($SearchString)){\r\n        $queryBuildResult .= \"OR SI.StockItemID ='$SearchString'\";\r\n    }\r\n    $queryBuildResult .= \")\";\r\n}\r\n\r\nfunction pricefilter($queryBuildResult, $min, $max)\r\n{\r\n    if ($queryBuildResult != \"\") {\r\n        $queryBuildResult .= \" AND \";\r\n    }\r\n    $queryBuildResult .= \"SI.SellPrice BETWEEN $min AND $max\";\r\n    return $queryBuildResult;\r\n}\r\n\r\nif (isset($_GET['pricefilter'])) {\r\n    $PriceFilter = $_GET['pricefilter'];\r\n    $_SESSION['pricefilter'] = $_GET['pricefilter'];\r\n} else if (isset($_SESSION['pricefilter'])) {\r\n    $PriceFilter = $_SESSION['pricefilter'];\r\n} else {\r\n    $PriceFilter = \"\";\r\n    $_SESSION['pricefilter'] = \"\";\r\n}\r\n\r\n\r\n$Offset = $PageNumber * $ProductsOnPage;\r\n\r\n\r\n\r\nif ($CategoryID == \"\") {\r\n    if ($queryBuildResult != \"\") {\r\n        $Query_sort = \"\r\n                SELECT SI.StockItemID, SI.StockItemName, SI.MarketingComments, TaxRate, RecommendedRetailPrice, ROUND(TaxRate * RecommendedRetailPrice / 100 + RecommendedRetailPrice,2) as SellPrice,\r\n                QuantityOnHand,\r\n                (SELECT ImagePath\r\n                FROM stockitemimages\r\n                WHERE StockItemID = SI.StockItemID LIMIT 1) as ImagePath,\r\n                (SELECT ImagePath FROM stockgroups JOIN stockitemstockgroups USING(StockGroupID) WHERE StockItemID = SI.StockItemID LIMIT 1) as BackupImagePath\r\n                FROM stockitems SI\r\n                JOIN stockitemholdings SIH USING(stockitemid)\r\n                WHERE \".$queryBuildResult.\"\r\n                GROUP BY StockItemID\r\n                ORDER BY \".$Sort.\"\r\n                LIMIT ?  OFFSET ?\";\r\n        $Query_count = \"\r\n                select count(*)\r\n                FROM stockitems SI\r\n                WHERE $queryBuildResult\";\r\n    }else{\r\n        $Query_sort = \"\r\n                SELECT SI.StockItemID, SI.StockItemName, SI.MarketingComments, TaxRate, RecommendedRetailPrice, ROUND(TaxRate * RecommendedRetailPrice / 100 + RecommendedRetailPrice,2) as SellPrice,\r\n                QuantityOnHand,\r\n                (SELECT ImagePath\r\n                FROM stockitemimages\r\n                WHERE StockItemID = SI.StockItemID LIMIT 1) as ImagePath,\r\n                (SELECT ImagePath FROM stockgroups JOIN stockitemstockgroups USING(StockGroupID) WHERE StockItemID = SI.StockItemID LIMIT 1) as BackupImagePath\r\n                FROM stockitems SI\r\n                JOIN stockitemholdings SIH USING(stockitemid)\r\n                GROUP BY StockItemID\r\n                ORDER BY \".$Sort.\"\r\n                LIMIT ?  OFFSET ?\";\r\n        $Query_count = \"\r\n                select count(*)\r\n                FROM stockitems SI\";\r\n    }\r\n    $Statement = mysqli_prepare($databaseConnection, $Query_sort);\r\n    mysqli_stmt_bind_param($Statement, \"ii\",$ProductsOnPage, $Offset);\r\n\r\n    $rows = mysqli_prepare($databaseConnection, $Query_count);\r\n}\r\n\r\nif ($CategoryID != \"\") {\r\n    if ($queryBuildResult != \"\") {\r\n        $Query_sort = \"\r\n               SELECT SI.StockItemID, SI.StockItemName, SI.MarketingComments, TaxRate, RecommendedRetailPrice,\r\n               ROUND(SI.TaxRate * SI.RecommendedRetailPrice / 100 + SI.RecommendedRetailPrice,2) as SellPrice,\r\n               QuantityOnHand,\r\n               (SELECT ImagePath FROM stockitemimages WHERE StockItemID = SI.StockItemID LIMIT 1) as ImagePath,\r\n               (SELECT ImagePath FROM stockgroups JOIN stockitemstockgroups USING(StockGroupID) WHERE StockItemID = SI.StockItemID LIMIT 1) as BackupImagePath\r\n               FROM stockitems SI\r\n               JOIN stockitemholdings SIH USING(stockitemid)\r\n               JOIN stockitemstockgroups SIG USING(StockItemID)\r\n               JOIN stockgroups SG USING(StockGroupID)\r\n               WHERE \".$queryBuildResult.\" AND SIG.StockGroupID = ?\r\n               GROUP BY StockItemID\r\n               ORDER BY \" . $Sort . \"\r\n               LIMIT ? OFFSET ?\";\r\n        $Query_count = \"\r\n                select count(*)\r\n                FROM stockitems SI\r\n                JOIN stockitemstockgroups SIG USING(StockItemID)\r\n                WHERE \".$queryBuildResult.\" AND SIG.StockGroupID = ?\";\r\n    } else {\r\n        $Query_sort = \"\r\n                SELECT SI.StockItemID, SI.StockItemName, SI.MarketingComments, TaxRate, RecommendedRetailPrice,\r\n                ROUND(SI.TaxRate * SI.RecommendedRetailPrice / 100 + SI.RecommendedRetailPrice,2) as SellPrice,\r\n                QuantityOnHand,\r\n                (SELECT ImagePath FROM stockitemimages WHERE StockItemID = SI.StockItemID LIMIT 1) as ImagePath,\r\n                (SELECT ImagePath FROM stockgroups JOIN stockitemstockgroups USING(StockGroupID) WHERE StockItemID = SI.StockItemID LIMIT 1) as BackupImagePath\r\n                FROM stockitems SI\r\n                JOIN stockitemholdings SIH USING(stockitemid)\r\n                JOIN stockitemstockgroups SIG USING(StockItemID)\r\n                JOIN stockgroups SG USING(StockGroupID)\r\n                WHERE SIG.StockGroupID = ?\r\n                GROUP BY StockItemID\r\n                ORDER BY \" . $Sort . \"\r\n                LIMIT ? OFFSET ?\";\r\n        $Query_count = \"\r\n                select count(*)\r\n                FROM stockitems SI\r\n                JOIN stockitemstockgroups SIG USING(StockItemID)\r\n                WHERE SIG.StockGroupID = ?\";\r\n    }\r\n    $Statement = mysqli_prepare($databaseConnection, $Query_sort);\r\n    mysqli_stmt_bind_param($Statement, \"iii\", $CategoryID, $ProductsOnPage, $Offset);\r\n\r\n    $rows = mysqli_prepare($databaseConnection, $Query_count);\r\n    mysqli_stmt_bind_param($rows, \"i\", $CategoryID);\r\n}\r\n\r\n\r\nmysqli_stmt_execute($rows);\r\n$Result = mysqli_stmt_get_result($rows);\r\n$Result = mysqli_fetch_all($Result, MYSQLI_ASSOC);\r\n\r\nmysqli_stmt_execute($Statement);\r\n$ReturnableResult = mysqli_stmt_get_result($Statement);\r\n$ReturnableResult = mysqli_fetch_all($ReturnableResult, MYSQLI_ASSOC);\r\n\r\n$amount = $Result[0];\r\nif (isset($amount)) {\r\n    $AmountOfPages = ceil($amount[\"count(*)\"] / $ProductsOnPage);\r\n}\r\n\r\n\r\n    function getVoorraadTekst($actueleVoorraad) {\r\n        if ($actueleVoorraad > 1000) {\r\n            return \"Ruime voorraad beschikbaar.\";\r\n        } else {\r\n            return \"Voorraad: $actueleVoorraad\";\r\n        }\r\n    }\r\n    function berekenVerkoopPrijs($adviesPrijs, $btw) {\r\n\t\treturn $btw * $adviesPrijs / 100 + $adviesPrijs;\r\n    }\r\n?>\r\n\r\n<div id=\"FilterFrame\"><h2 class=\"FilterText\"><i class=\"fas fa-filter\"></i> Filteren </h2>\r\n    <form>\r\n        <div id=\"FilterOptions\">\r\n            <h4 class=\"FilterTopMargin\"><i class=\"fas fa-search\"></i> Zoeken</h4>\r\n            <input type=\"text\" name=\"search_string\" id=\"search_string\"\r\n                   value=\"<?php print (isset($_GET['search_string'])) ? $_GET['search_string'] : \"\"; ?>\"\r\n                   class=\"form-submit\">\r\n            <h4 class=\"FilterTopMargin\"><i class=\"fas fa-list-ol\"></i> Aantal producten op pagina</h4>\r\n            <input type=\"hidden\" name=\"category_id\" id=\"category_id\"\r\n                   value=\"<?php print (isset($_GET['category_id'])) ? $_GET['category_id'] : \"\"; ?>\">\r\n            <input type=\"hidden\" name=\"sort\" id=\"sort\" value=\"<?php print ($_SESSION['sort']); ?>\">\r\n            <input type=\"hidden\" name=\"ColorID\" id=\"ColorID\" value=\"<?php print ($_SESSION['ColorID']); ?>\">\r\n            <input type=\"hidden\" name=\"SizeID\" id=\"SizeID\" value=\"<?php print ($_SESSION['SizeID']); ?>\">\r\n            <input type=\"hidden\" name=\"category_id\" id=\"category_id\" value=\"<?php if (isset($_GET['category_id'])) {print ($_GET['category_id']);} ?>\">\r\n            <input type=\"hidden\" name=\"result_page_numbers\" id=\"result_page_numbers\" value=\"<?php print (isset($_GET['result_page_numbers'])) ? $_GET['result_page_numbers'] : \"0\"; ?>\">\r\n            <input type=\"hidden\" name=\"products_on_page\" id=\"products_on_page\" value=\"<?php print ($_SESSION['products_on_page']); ?>\">\r\n            <select name=\"products_on_page\" id=\"products_on_page\" onchange=\"this.form.submit()\">>\r\n                <option value=\"25\" <?php if ($_SESSION['products_on_page'] == 25) {\r\n                    print \"selected\";\r\n                } ?>>25\r\n                </option>\r\n                <option value=\"50\" <?php if ($_SESSION['products_on_page'] == 50) {\r\n                    print \"selected\";\r\n                } ?>>50\r\n                </option>\r\n                <option value=\"75\" <?php if ($_SESSION['products_on_page'] == 75) {\r\n                    print \"selected\";\r\n                } ?>>75\r\n                </option>\r\n                <option value=\"100\" <?php if ($_SESSION['products_on_page'] == 100) {\r\n                    print \"selected\";\r\n                } ?>>100\r\n                </option>\r\n            </select>\r\n            <h4 class=\"FilterTopMargin\"><i class=\"fas fa-sort\"></i> Sorteren</h4>\r\n            <select name=\"sort\" id=\"sort\" onchange=\"this.form.submit()\">>\r\n                <option value=\"price_low_high\" <?php if ($_SESSION['sort'] == \"price_low_high\") {\r\n                    print \"selected\";\r\n                } ?>>Prijs oplopend\r\n                </option>\r\n                <option value=\"price_high_low\" <?php if ($_SESSION['sort'] == \"price_high_low\") {\r\n                    print \"selected\";\r\n                } ?> >Prijs aflopend\r\n                </option>\r\n                <option value=\"name_low_high\" <?php if ($_SESSION['sort'] == \"name_low_high\") {\r\n                    print \"selected\";\r\n                } ?>>Naam oplopend\r\n                </option>\r\n                <option value=\"name_high_low\" <?php if ($_SESSION['sort'] == \"name_high_low\") {\r\n                    print \"selected\";\r\n                } ?>>Naam aflopend\r\n                </option>\r\n            </select>\r\n            <h4 class=\"FilterTopMargin\"><i class=\"fas fa-tags\"> </i> prijs</h4>\r\n            <input type=\"range\" name=\"price\" id=\"price\" min=\"0\" max=\"1000\" step=\"10\"\r\n                   value=\"<?php print (isset($_GET['price'])) ? $_GET['price'] : 1000; ?>\"\r\n                   oninput=\"this.form.submit()\">\r\n            <h4 class=\"FilterTopMargin\"><i class=\"fas fa-palette\"></i> Kleur</h4>\r\n            <select name=\"ColorID\" id=\"ColorID\" onchange=\"this.form.submit()\">>\r\n                <option value=\"0\" <?php if ($_SESSION['ColorID'] == \"0\") {\r\n                    print \"selected\";\r\n                } ?>> kies kleur\r\n                </option>\r\n                <option value=\"1\" <?php if ($_SESSION['ColorID'] == \"1\") {\r\n                    print \"selected\";\r\n                } ?> >zwart\r\n                </option>\r\n                <option value=\"2\" <?php if ($_SESSION['ColorID'] == \"2\") {\r\n                    print \"selected\";\r\n                } ?>>wit\r\n                </option>\r\n                <option value=\"3\" <?php if ($_SESSION['ColorID'] == \"3\") {\r\n                    print \"selected\";\r\n                } ?>>blauw\r\n                </option>\r\n            </select>\r\n            <h4 class=\"FilterTopMargin\"><i class=\"fas fa-ruler-combined\"></i> Maat</h4>\r\n            <select name=\"SizeID\" id=\"SizeID\" onchange=\"this.form.submit()\">>\r\n                <option value=\"0\" <?php if ($_SESSION['SizeID'] == \"0\") {\r\n                    print \"selected\";\r\n                } ?>> kies maat\r\n                </option>\r\n                <option value=\"1\" <?php if ($_SESSION['SizeID'] == \"1\") {\r\n                    print \"selected\";\r\n                } ?> >s\r\n                </option>\r\n                <option value=\"2\" <?php if ($_SESSION['SizeID'] == \"2\") {\r\n                    print \"selected\";\r\n                } ?>>m\r\n                </option>\r\n                <option value=\"3\" <?php if ($_SESSION['SizeID'] == \"3\") {\r\n                    print \"selected\";\r\n                } ?>>l\r\n                </option>\r\n                <option value=\"4\" <?php if ($_SESSION['SizeID'] == \"4\") {\r\n                    print \"selected\";\r\n                } ?>>xl\r\n                </option>\r\n                <option value=\"5\" <?php if ($_SESSION['SizeID'] == \"5\") {\r\n                    print \"selected\";\r\n                } ?>>xxl\r\n                </option>\r\n                <option value=\"6\" <?php if ($_SESSION['SizeID'] == \"6\") {\r\n                    print \"selected\";\r\n                } ?>>xl\r\n                </option>\r\n                <option value=\"7\" <?php if ($_SESSION['SizeID'] == \"7\") {\r\n                    print \"selected\";\r\n                } ?>>xxxl\r\n                </option>\r\n            </select>\r\n        </div>\r\n    </form>\r\n</div>\r\n\r\n<div id=\"ResultsArea\" class=\"Browse\">\r\n    <?php\r\n    if (isset($ReturnableResult) && count($ReturnableResult) > 0) {\r\n        foreach ($ReturnableResult as $row) {\r\n            ?>\r\n            <a class=\"ListItem\" href='view.php?id=<?php print $row['StockItemID']; ?>'>\r\n                <div id=\"ProductFrame\">\r\n                    <?php\r\n                    if (isset($row['ImagePath'])) { ?>\r\n                        <div class=\"ImgFrame\"\r\n                             style=\"background-image: url('<?php print \"Public/StockItemIMG/\" . $row['ImagePath']; ?>'); background-size: 230px; background-repeat: no-repeat; background-position: center;\"></div>\r\n                    <?php } else if (isset($row['BackupImagePath'])) { ?>\r\n                        <div class=\"ImgFrame\"\r\n                             style=\"background-image: url('<?php print \"Public/StockGroupIMG/\" . $row['BackupImagePath'] ?>'); background-size: cover;\"></div>\r\n                    <?php }\r\n                    ?>\r\n\r\n                    <div id=\"StockItemFrameRight\">\r\n                        <div class=\"CenterPriceLeftChild\">\r\n                            <h1 class=\"StockItemPriceText\"><?php print \"€\".number_format(berekenVerkoopPrijs($row[\"RecommendedRetailPrice\"], $row[\"TaxRate\"]), 2,\",\", \".\"); ?></h1>\r\n                            <h6>Inclusief BTW </h6>\r\n                        </div>\r\n                    </div>\r\n                    <h1 class=\"StockItemID\">Artikelnummer: <?php print $row[\"StockItemID\"]; ?></h1>\r\n                    <p class=\"StockItemName\"><?php print $row[\"StockItemName\"]; ?></p>\r\n                    <p class=\"StockItemComments\"><?php print $row[\"MarketingComments\"]; ?></p>\r\n                    <h4 class=\"ItemQuantity\"><?php print getVoorraadTekst($row[\"QuantityOnHand\"]); ?></h4>\r\n                </div>\r\n            </a>\r\n        <?php } ?>\r\n\r\n        <form id=\"PageSelector\">\r\n            <?php\r\n            if ($AmountOfPages > 0) {\r\n                for ($i = 1; $i <= $AmountOfPages; $i++) {\r\n                    if ($PageNumber == ($i - 1)) {\r\n                        ?>\r\n                        <div id=\"SelectedPage\"><?php print $i; ?></div><?php\r\n                    } else { ?>\r\n                        <button id=\"page_number\" class=\"PageNumber\" value=\"<?php print($i-1); ?>\" type=\"submit\"\r\n                                name=\"page_number\"><?php print($i); ?></button>\r\n                    <?php }\r\n                }\r\n            }\r\n            ?>\r\n        </form>\r\n        <?php\r\n    } else {\r\n        ?>\r\n        <h2 id=\"NoSearchResults\">\r\n            Yarr, er zijn geen resultaten gevonden.\r\n        </h2>\r\n        <?php\r\n    }\r\n    ?>\r\n\r\n</div>\r\n\r\n<?php\r\ninclude __DIR__ . \"/footer.php\";\r\n?>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/browse.php b/browse.php
--- a/browse.php	(revision a450fa0d80876efd4b5b749793486868cf2baf04)
+++ b/browse.php	(date 1671612289956)
@@ -295,30 +295,32 @@
             <input type="range" name="price" id="price" min="0" max="1000" step="10"
                    value="<?php print (isset($_GET['price'])) ? $_GET['price'] : 1000; ?>"
                    oninput="this.form.submit()">
+
             <h4 class="FilterTopMargin"><i class="fas fa-palette"></i> Kleur</h4>
             <select name="ColorID" id="ColorID" onchange="this.form.submit()">>
                 <option value="0" <?php if ($_SESSION['ColorID'] == "0") {
                     print "selected";
-                } ?>> kies kleur
+                } ?>>
                 </option>
-                <option value="1" <?php if ($_SESSION['ColorID'] == "1") {
+                <option value="1" <?php if ($_SESSION['ColorID'] == "3") {
                     print "selected";
                 } ?> >zwart
                 </option>
-                <option value="2" <?php if ($_SESSION['ColorID'] == "2") {
+                <option value="name_low_high" <?php if ($_SESSION['ColorID'] == "2") {
                     print "selected";
                 } ?>>wit
                 </option>
-                <option value="3" <?php if ($_SESSION['ColorID'] == "3") {
+                <option value="name_high_low" <?php if ($_SESSION['ColorID'] == "3") {
                     print "selected";
                 } ?>>blauw
                 </option>
             </select>
+            
             <h4 class="FilterTopMargin"><i class="fas fa-ruler-combined"></i> Maat</h4>
             <select name="SizeID" id="SizeID" onchange="this.form.submit()">>
                 <option value="0" <?php if ($_SESSION['SizeID'] == "0") {
                     print "selected";
-                } ?>> kies maat
+                } ?>>
                 </option>
                 <option value="1" <?php if ($_SESSION['SizeID'] == "1") {
                     print "selected";
